<!Doctype html>
<html>
    <head>
        <script type="text/javascript">
            window.killTimer = false;
            window.timeIsUp = false;
            /** Generates integers between low (inclusive) and high (exclusive) */
            function generateRandomInteger(low, high) {
                const lowCeil = Math.ceil(low);
                const highFloor = Math.floor(high);
                const randomFloat = lowCeil + Math.random() * (highFloor - lowCeil);

                return Math.floor(randomFloat);
            }

            // Cool little thing that lets me check for decimals
            function decimalCheck(num){
                if (num == Math.floor(num)) {
                    return false;
                } else {
                    return true;
                }
            }

            function answerSkew(answer, answerSkewInt, answerSkewOperatorInt){
                var displayAnswer = -0.01;
                displayAnswer = answer + answerSkewInt;
                return displayAnswer
            }

            async function answerCheck(userchoice, coinflip, score, timeUp){
                if (window.timeIsUp == true){
                    document.getElementById("userAnswer").innerHTML = 'Out of Time!';
                    await sleep(2000);
                    main(score);
                }
                else if (userchoice == true && coinflip == 1){
                    document.getElementById("userAnswer").innerHTML = 'Correct!';
                    score = score + 1;
                    document.getElementById("score").innerHTML = 'Score: ' + score;
                    await sleep(2000);
                    main(score);
                }
                else if (userchoice == false && coinflip == 2){
                    document.getElementById("userAnswer").innerHTML = 'Correct!';
                    score = score + 1;
                    document.getElementById("score").innerHTML = 'Score: ' + score;
                    await sleep(2000);
                    main(score);
                }
                else if (userchoice == true && coinflip == 2){
                    document.getElementById("userAnswer").innerHTML = 'Better luck next time!';
                    await sleep(2000);
                    main(score);
                }
                else if (userchoice == false && coinflip == 1){
                    document.getElementById("userAnswer").innerHTML = 'Better luck next time!';
                    await sleep(2000);
                    main(score);
                }
            }

            async function countdownTimer(duration){
                var timeRemaining = 0;
                var timeElapsed = 0;
                for (var i = 0; i <= duration; i++) {
                    timeRemaining = duration - timeElapsed;
                    timeElapsed++;
                    document.getElementById("timer").innerHTML = timeRemaining + ' seconds remaining.';
                    await sleep(1000);
                    if (window.killTimer == true){
                        return false;
                    }
                }
                console.log("Time is up countdownTimer()");
                window.timeIsUp = true;
                console.log(window.timeIsUp)
                answerCheck(true, 1, 0, true);
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function main(score){
                
                // Initialization
                var operatorInt = 0;
                var correctAnswer = false;
                var displayAnswer = 0;
                var coinflip = 0;
                var number1 = 0;
                var number2 = 0;
                var answer = 0.01;
                var memory = 0;

                var userchoice;
                var timeUp;
                
                var operator = '';
                var question = '';

                window.killTimer = false

                document.getElementById("userAnswer").innerHTML = ' ';

                //If the answer contains a decimal a new question is generated
                while (decimalCheck(answer) == true){
                    //Generates all required random numbers
                    var operatorInt = generateRandomInteger(1,5);
                    var number1 = generateRandomInteger(1,13);
                    var number2 = generateRandomInteger(1,13);
                    var coinflip = generateRandomInteger(1,3);

                    var answerSkewInt = generateRandomInteger(1,13)
                    var answerSkewOperatorInt = generateRandomInteger(1,5)

                    // Take the randomly generated 'operatorInt' and use it to assign an operator.
                    if (operatorInt == 1){
                        operator = '+';
                        answer = number1 + number2;
                    }
                    else if (operatorInt == 2){
                        operator = '-';

                        //Checks if the number that is being subtracted from is larger than the number subtracting
                        if (number1 >= number2){
                            answer = number1 - number2;
                        }else{
                            // Uses memory to swap the vars
                            memory = number1;
                            number1 = number2;
                            number2 = memory;
                            answer = number1 - number2;
                        }
                    }
                    else if (operatorInt == 3){
                        operator = '*';
                        answer = number1 * number2;
                    }
                    else if (operatorInt == 4){
                        operator = '/';
                        answer = number1 / number2;
                    }
                }

                //Coinflip to decide whether or not the correct answer will be put at the end of the equation
                if (coinflip == 1){
                    correctAnswer = true;
                    displayAnswer = answer;
                }else{
                    correctAnswer = false;
                    displayAnswer = answerSkew(answer, answerSkewInt, answerSkewOperatorInt);
                }



                // Procedurally generates the equation
                var question = 'Question: ' + number1 + ' ' + operator + ' ' + number2 + ' = ' + displayAnswer;
                document.getElementById("question").innerHTML = question;

                // Input handling
                document.getElementById("trueButton").addEventListener("click", function() {
                    timeUp = false;
                    userchoice = true;
                    window.killTimer = true;
                    answerCheck(userchoice, coinflip, score, timeUp);
                });

                document.getElementById("falseButton").addEventListener("click", function() {
                    timeUp = false;
                    userchoice = false;
                    window.killTimer = true;
                    answerCheck(userchoice, coinflip, score, timeUp);
                });


                document.getElementById("answer").innerHTML = 'Answer: ' + answer;
                document.getElementById("coinflip").innerHTML = 'Coinflip: ' + coinflip;
                document.getElementById("operatorInt").innerHTML = 'Operator Int: ' + operatorInt;

                // IMPLEMENT DIFFICULTY
                countdownTimer(10)

            }
        </script>
    </head>
    <body onload="main(0)">
        <p id="score"></p>
        <span style="float: right" id="timer">00:00</span>
        <center>
        <p id="question"></p>
        <form> 
            <input type=button id="trueButton" value="True">
            <input type=button id="falseButton" value="False">
        </form>
        <p id="userAnswer"></p>
        <hr>
        <h3>Debuging stuffs</h3>
        <p id="answer"></p>
        <p id="coinflip"></p>
        <p id="operatorInt"></p>
        </center>
    </body>
</html>
